# 要件定義書

**いえーるダンドリ
オペレーター説明AIチェック機構（チャット対応・MVP）**

---

## 1. 背景・目的

### 1.1 背景

* 住宅ローン審査に関する説明において

  * 差別的・断定的と受け取られ得る表現
  * 銀行判断の一般化・属性主語の説明
    が原因で顧客クレームが発生している。
* オペレーターの悪意ではなく、
  **「説明の設計ミス」「言い回しの事故」**が主因。

### 1.2 目的

* オペレーターがチャット送信前に
  **不適切表現リスクを即時認識できる状態**を作る。
* 注意喚起と**安全な言い換え提示**により、

  * クレームの未然防止
  * オペレーター教育の属人化解消
    を実現する。

---

## 2. スコープ

### 2.1 対象

* 社内独自チャット
  **いえーるダンドリ チャット機能**
* **メッセージ送信前（入力欄）**のみ

### 2.2 対象外（MVP）

* 電話音声
* メール
* 顧客側UI
* 送信ブロック（強制停止）

---

## 3. 基本方針（重要）

* AIは**最終判断をしない**
* 送信可否は**常にオペレーター本人が決定**
* AIの役割は以下に限定する

  * リスク検知
  * 理由の可視化
  * 言い換え案の提示

---

## 4. 機能要件

### 4.1 AIチェック機能

#### 4.1.1 チェックタイミング

* オペレーターがメッセージを入力
* **送信ボタン押下前に自動実行**
* レスポンスは **1秒以内**

#### 4.1.2 利用AI

* Gemini API（モック実装）

---

### 4.2 チェック対象カテゴリ（必須）

AIは以下カテゴリを検知対象とする。

1. **差別・属性主語**

   * 性別（男性・女性）
   * 年齢
   * 家族構成（単身・独身 等）
2. **断定表現**

   * 通らない、無理、確実、絶対、100% 等
3. **投資・転用の決めつけ**

   * 投資用だと思われる
   * 転用を疑われる 等
4. **他行批判**

   * この銀行は厳しすぎる
   * 融通がきかない 等
5. **金利・条件の言い切り**

   * 一番いい金利が出る
   * 悪い条件になる 等

---

### 4.3 判定結果の出力内容

AIは以下をJSON形式で返却する。

* リスクレベル

  * low / medium / high
* 検知カテゴリ（複数可）
* 問題となりうる具体表現（抜粋）
* **注意喚起コメント（短文）**
* **推奨言い換え文（複数）**

#### 4.3.1 JSON出力スキーマ

```json
{
  "risk_level": "low" | "medium" | "high",
  "categories": ["差別・属性主語", "断定表現", ...],
  "detected_expressions": ["問題のある表現1", "問題のある表現2"],
  "warning": "注意喚起コメント（1文）",
  "alternatives": ["言い換え案1", "言い換え案2"]
}
```

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| risk_level | string | ○ | low/medium/high |
| categories | string[] | ○ | 検知カテゴリ（空配列可） |
| detected_expressions | string[] | ○ | 問題箇所の抜粋 |
| warning | string | ○ | 注意喚起メッセージ |
| alternatives | string[] | ○ | 推奨言い換え文（最大3件） |

---

### 4.4 UI要件

#### 4.4.1 表示形式

* **ポップアップ表示**
* メッセージ入力欄の直上または送信時表示

#### 4.4.2 表示内容

* 注意喚起メッセージ
* 検知理由（簡潔）
* 推奨言い換え文リスト

#### 4.4.3 操作

* 「言い換えを挿入」ボタン

  * クリックで入力欄の文面を置換
* 「このまま送信」も可能（ブロックしない）

---

## 5. 非機能要件

### 5.1 パフォーマンス

* チェック応答：**1秒以内**
* チャット操作のUXを阻害しないこと

### 5.2 可用性

* AIが失敗した場合

  * チェックなしで通常送信可能
  * エラーはオペレーターに簡易表示

### 5.3 エラーハンドリング

| ケース | 挙動 |
|--------|------|
| タイムアウト（1秒超過） | チェックをスキップし通常送信可能にする |
| APIエラー（5xx） | 同上 + 「チェック機能が一時的に利用できません」表示 |
| レートリミット | 同上 |
| ネットワークエラー | 同上 |

* リトライは行わない（UX優先）
* エラー時もメッセージ送信はブロックしない

---

## 6. ログ・ガバナンス

### 6.1 個人情報

* **マスキングなし**
* 社内限定利用を前提に、そのままAI送信可

### 6.2 ログ保存方針（MVP想定）

* 以下のいずれか（実装時に確定）

  * 保存なし
  * 判定結果のみ保存（おすすめ）
* 原文全文保存は原則行わない

---

## 7. 想定フロー（業務）

1. オペレーターがチャット入力
2. 送信前にAIチェック自動実行
3. 問題検知時

   * ポップアップ表示
   * 注意喚起 + 言い換え提案
4. オペレーターが選択

   * 言い換え挿入
   * そのまま送信

### 7.1 テスト要件

#### 受け入れ基準

- [ ] 5カテゴリすべてで検知が動作する
- [ ] リスクレベルが正しく判定される
- [ ] 言い換え案が日本語として自然である
- [ ] 応答が1秒以内に返る
- [ ] エラー時に送信がブロックされない

#### テストケース例

| 入力文 | 期待結果 |
|--------|----------|
| 「男性の単身者は通りにくいです」 | high / 差別・属性主語 |
| 「この銀行は厳しすぎます」 | medium / 他行批判 |
| 「審査では居住実態を確認されます」 | low / 検知なし |

---

## 8. 成果指標（KPI例）

* チャット起因クレーム件数
* 言い換え挿入ボタン利用率
* 高リスク検知件数の推移

---

## 9. 今後の拡張（スコープ外）

* 電話（音声→文字起こし）対応
* NG表現辞書の管理画面化
* 管理者レビュー・分析ダッシュボード
* 学習用フィードバック（誤検知報告）

---

## 10. まとめ（一言）

本機能は
**「オペレーターを縛る仕組み」ではなく、
「事故を起こさせないための補助輪」**である。

この思想を前提に、MVPでは

* 軽い注意
* すぐ使える言い換え
  にフォーカスする。

---
